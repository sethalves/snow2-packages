
(define (base64-test-str str encoded-lst)
  (let ((encoded (base64:encode (string->utf8 str)))
        (decoded (base64:decode (u8-list->bytevector encoded-lst))))
    ;; (cout "encoded=" (bytevector->u8-list encoded) "\n")
    ;; (cout "encoded=" (utf8->string encoded) "\n")
    ;; (cout "decoded='" (utf8->string decoded) "'\n")
    ;; (cout "decoded=" (bytevector->u8-list decoded) "\n")
    (and
     (equal? encoded (u8-list->bytevector encoded-lst))
     (equal? decoded (string->utf8 str)))))


(define (main-program)


  (write
   (base64:encode (bytevector 23 8 169 183 53 178 226 182 206
                              55 9 178 8 229 174 63 114 94 222 127)))
  (newline)


  (and
   (equal? (base64:encode-string "okay okay okay") "b2theSBva2F5IG9rYXk=")
   (base64-test-str "" '())
   (base64-test-str "abcdefg" '(89 87 74 106 90 71 86 109 90 119 61 61))
   (base64-test-str "abcdefgh" '(89 87 74 106 90 71 86 109 90 50 103 61))
   (base64-test-str "abcdefghi" '(89 87 74 106 90 71 86 109 90 50 104 112))
   (base64-test-str "abcdefghij" '(89 87 74 106 90 71 86 109 90 50
                                      104 112 97 103 61 61))
   (base64-test-str "just the tip"
                    '(97 110 86 122 100 67 66 48 97 71 85 103 100 71 108 119))

   (base64-test-str
    "GLaDOS, short for Genetic Lifeform and Disk Operating System, is a fictional artificially intelligent computer system in Valve Software's Half-Life video game series and the main antagonist in the video games Portal and Portal 2. She was created by Erik Wolpaw and Kim Swift and is voiced by Ellen McLain. She is responsible for testing and maintenance in Aperture Science research facility in both video games. While she initially appears to simply be a voice to guide and aid the player, her words and actions become increasingly malicious until she makes her intentions clear. At this point the game reveals that she is corrupted and used a neurotoxin to kill the scientists in the lab before the events of Portal. She is killed at the end by the player-character Chell but is revealed to have survived in the credits song \"Still Alive\". She appeared in the sequel, Portal 2, which takes place many years after the events of Portal and follows the exploits of GLaDOS, Chell, and other characters.
The inspiration for her creation extends from Wolpaw's use of a text-to-speech program while writing lines for the video game Psychonauts. Other Psychonauts designers were finding the lines funnier as a result of the text-to-speech voice. GLaDOS was originally intended to be used in the first area of Portal; she was well-received by other designers and her role was expanded as a result. Play testers were motivated to complete tests in the game due to her guidance. While the game was originally designed to have other characters, they later decided to remove them and leave GLaDOS as the only character players encounter. The physical appearance of GLaDOS had gone through several designs, one which featured a large disk below her. McLain imitated dialog written in a text-to-speech program with her own voice, which was later converted to sound more robotic. She also sang the lyrics for \"Still Alive\", written by Jonathan Coulton, which played during the credits of Portal. The song became hugely successful; it appeared in the Rock Band series and has been a popular song for YouTube users to cover."
    '(82 48 120 104 82 69 57 84 76 67 66 122 97 71 57 121 100 67 66
         109 98 51 73 103 82 50 86 117 90 88 82 112 89 121 66 77 97 87 90 108
         90 109 57 121 98 83 66 104 98 109 81 103 82 71 108 122 97 121 66 80 99
         71 86 121 89 88 82 112 98 109 99 103 85 51 108 122 100 71 86 116 76
         67 66 112 99 121 66 104 73 71 90 112 89 51 82 112 98 50 53 104 98 67
         66 104 99 110 82 112 90 109 108 106 97 87 70 115 98 72 107 103 97 87
         53 48 90 87 120 115 97 87 100 108 98 110 81 103 89 50 57 116 99 72 86
         48 90 88 73 103 99 51 108 122 100 71 86 116 73 71 108 117 73 70 90
         104 98 72 90 108 73 70 78 118 90 110 82 51 89 88 74 108 74 51 77 103
         83 71 70 115 90 105 49 77 97 87 90 108 73 72 90 112 90 71 86 118 73 71
         100 104 98 87 85 103 99 50 86 121 97 87 86 122 73 71 70 117 90 67 66
         48 97 71 85 103 98 87 70 112 98 105 66 104 98 110 82 104 90 50 57
         117 97 88 78 48 73 71 108 117 73 72 82 111 90 83 66 50 97 87 82 108 98
         121 66 110 89 87 49 108 99 121 66 81 98 51 74 48 89 87 119 103 89 87
         53 107 73 70 66 118 99 110 82 104 98 67 65 121 76 105 66 84 97 71
         85 103 100 50 70 122 73 71 78 121 90 87 70 48 90 87 81 103 89 110 107
         103 82 88 74 112 97 121 66 88 98 50 120 119 89 88 99 103 89 87 53 107
         73 69 116 112 98 83 66 84 100 50 108 109 100 67 66 104 98 109 81 103
         97 88 77 103 100 109 57 112 89 50 86 107 73 71 74 53 73 69 86 115
         98 71 86 117 73 69 49 106 84 71 70 112 98 105 52 103 85 50 104 108 73
         71 108 122 73 72 74 108 99 51 66 118 98 110 78 112 89 109 120 108 73
         71 90 118 99 105 66 48 90 88 78 48 97 87 53 110 73 71 70 117 90 67 66
         116 89 87 108 117 100 71 86 117 89 87 53 106 90 83 66 112 98 105 66
         66 99 71 86 121 100 72 86 121 90 83 66 84 89 50 108 108 98 109 78 108
         73 72 74 108 99 50 86 104 99 109 78 111 73 71 90 104 89 50 108 115 97
         88 82 53 73 71 108 117 73 71 74 118 100 71 103 103 100 109 108 107
         90 87 56 103 90 50 70 116 90 88 77 117 73 70 100 111 97 87 120 108 73
         72 78 111 90 83 66 112 98 109 108 48 97 87 70 115 98 72 107 103 89 88
         66 119 90 87 70 121 99 121 66 48 98 121 66 122 97 87 49 119 98 72 107
         103 89 109 85 103 89 83 66 50 98 50 108 106 90 83 66 48 98 121 66
         110 100 87 108 107 90 83 66 104 98 109 81 103 89 87 108 107 73 72 82
         111 90 83 66 119 98 71 70 53 90 88 73 115 73 71 104 108 99 105 66 51
         98 51 74 107 99 121 66 104 98 109 81 103 89 87 78 48 97 87 57 117 99
         121 66 105 90 87 78 118 98 87 85 103 97 87 53 106 99 109 86 104 99
         50 108 117 90 50 120 53 73 71 49 104 98 71 108 106 97 87 57 49 99 121
         66 49 98 110 82 112 98 67 66 122 97 71 85 103 98 87 70 114 90 88 77
         103 97 71 86 121 73 71 108 117 100 71 86 117 100 71 108 118 98 110
         77 103 89 50 120 108 89 88 73 117 73 69 70 48 73 72 82 111 97 88 77
         103 99 71 57 112 98 110 81 103 100 71 104 108 73 71 100 104 98 87 85
         103 99 109 86 50 90 87 70 115 99 121 66 48 97 71 70 48 73 72 78 111 90
         83 66 112 99 121 66 106 98 51 74 121 100 88 66 48 90 87 81 103 89
         87 53 107 73 72 86 122 90 87 81 103 89 83 66 117 90 88 86 121 98 51 82
         118 101 71 108 117 73 72 82 118 73 71 116 112 98 71 119 103 100 71 104
         108 73 72 78 106 97 87 86 117 100 71 108 122 100 72 77 103 97 87 52
         103 100 71 104 108 73 71 120 104 89 105 66 105 90 87 90 118 99 109
         85 103 100 71 104 108 73 71 86 50 90 87 53 48 99 121 66 118 90 105 66
         81 98 51 74 48 89 87 119 117 73 70 78 111 90 83 66 112 99 121 66 114
         97 87 120 115 90 87 81 103 89 88 81 103 100 71 104 108 73 71 86 117
         90 67 66 105 101 83 66 48 97 71 85 103 99 71 120 104 101 87 86 121 76
         87 78 111 89 88 74 104 89 51 82 108 99 105 66 68 97 71 86 115 98 67 66
         105 100 88 81 103 97 88 77 103 99 109 86 50 90 87 70 115 90 87 81 103
         100 71 56 103 97 71 70 50 90 83 66 122 100 88 74 50 97 88 90 108 90
         67 66 112 98 105 66 48 97 71 85 103 89 51 74 108 90 71 108 48 99 121
         66 122 98 50 53 110 73 67 74 84 100 71 108 115 98 67 66 66 98 71 108
         50 90 83 73 117 73 70 78 111 90 83 66 104 99 72 66 108 89 88 74 108 90
         67 66 112 98 105 66 48 97 71 85 103 99 50 86 120 100 87 86 115 76
         67 66 81 98 51 74 48 89 87 119 103 77 105 119 103 100 50 104 112 89 50
         103 103 100 71 70 114 90 88 77 103 99 71 120 104 89 50 85 103 98 87 70
         117 101 83 66 53 90 87 70 121 99 121 66 104 90 110 82 108 99 105 66
         48 97 71 85 103 90 88 90 108 98 110 82 122 73 71 57 109 73 70 66 118
         99 110 82 104 98 67 66 104 98 109 81 103 90 109 57 115 98 71 57 51 99
         121 66 48 97 71 85 103 90 88 104 119 98 71 57 112 100 72 77 103 98 50
         89 103 82 48 120 104 82 69 57 84 76 67 66 68 97 71 86 115 98 67 119
         103 89 87 53 107 73 71 57 48 97 71 86 121 73 71 78 111 89 88 74 104 89
         51 82 108 99 110 77 117 67 108 82 111 90 83 66 112 98 110 78 119 97 88
         74 104 100 71 108 118 98 105 66 109 98 51 73 103 97 71 86 121 73 71 78
         121 90 87 70 48 97 87 57 117 73 71 86 52 100 71 86 117 90 72 77 103
         90 110 74 118 98 83 66 88 98 50 120 119 89 88 99 110 99 121 66 49 99
         50 85 103 98 50 89 103 89 83 66 48 90 88 104 48 76 88 82 118 76 88 78
         119 90 87 86 106 97 67 66 119 99 109 57 110 99 109 70 116 73 72 100
         111 97 87 120 108 73 72 100 121 97 88 82 112 98 109 99 103 98 71 108
         117 90 88 77 103 90 109 57 121 73 72 82 111 90 83 66 50 97 87 82 108
         98 121 66 110 89 87 49 108 73 70 66 122 101 87 78 111 98 50 53 104 100
         88 82 122 76 105 66 80 100 71 104 108 99 105 66 81 99 51 108 106 97
         71 57 117 89 88 86 48 99 121 66 107 90 88 78 112 90 50 53 108 99 110
         77 103 100 50 86 121 90 83 66 109 97 87 53 107 97 87 53 110 73 72 82
         111 90 83 66 115 97 87 53 108 99 121 66 109 100 87 53 117 97 87 86 121
         73 71 70 122 73 71 69 103 99 109 86 122 100 87 120 48 73 71 57 109
         73 72 82 111 90 83 66 48 90 88 104 48 76 88 82 118 76 88 78 119 90 87
         86 106 97 67 66 50 98 50 108 106 90 83 52 103 82 48 120 104 82 69 57
         84 73 72 100 104 99 121 66 118 99 109 108 110 97 87 53 104 98 71
         120 53 73 71 108 117 100 71 86 117 90 71 86 107 73 72 82 118 73 71 74
         108 73 72 86 122 90 87 81 103 97 87 52 103 100 71 104 108 73 71 90 112
         99 110 78 48 73 71 70 121 90 87 69 103 98 50 89 103 85 71 57 121 100
         71 70 115 79 121 66 122 97 71 85 103 100 50 70 122 73 72 100 108 98
         71 119 116 99 109 86 106 90 87 108 50 90 87 81 103 89 110 107 103 98
         51 82 111 90 88 73 103 90 71 86 122 97 87 100 117 90 88 74 122 73 71
         70 117 90 67 66 111 90 88 73 103 99 109 57 115 90 83 66 51 89 88 77
         103 90 88 104 119 89 87 53 107 90 87 81 103 89 88 77 103 89 83 66
         121 90 88 78 49 98 72 81 117 73 70 66 115 89 88 107 103 100 71 86 122
         100 71 86 121 99 121 66 51 90 88 74 108 73 71 49 118 100 71 108 50 89
         88 82 108 90 67 66 48 98 121 66 106 98 50 49 119 98 71 86 48 90 83
         66 48 90 88 78 48 99 121 66 112 98 105 66 48 97 71 85 103 90 50 70 116
         90 83 66 107 100 87 85 103 100 71 56 103 97 71 86 121 73 71 100 49 97
         87 82 104 98 109 78 108 76 105 66 88 97 71 108 115 90 83 66 48 97 71
         85 103 90 50 70 116 90 83 66 51 89 88 77 103 98 51 74 112 90 50 108
         117 89 87 120 115 101 83 66 107 90 88 78 112 90 50 53 108 90 67 66 48
         98 121 66 111 89 88 90 108 73 71 57 48 97 71 86 121 73 71 78 111 89 88
         74 104 89 51 82 108 99 110 77 115 73 72 82 111 90 88 107 103 98 71
         70 48 90 88 73 103 90 71 86 106 97 87 82 108 90 67 66 48 98 121 66 121
         90 87 49 118 100 109 85 103 100 71 104 108 98 83 66 104 98 109 81 103
         98 71 86 104 100 109 85 103 82 48 120 104 82 69 57 84 73 71 70 122 73
         72 82 111 90 83 66 118 98 109 120 53 73 71 78 111 89 88 74 104 89
         51 82 108 99 105 66 119 98 71 70 53 90 88 74 122 73 71 86 117 89 50 57
         49 98 110 82 108 99 105 52 103 86 71 104 108 73 72 66 111 101 88 78
         112 89 50 70 115 73 71 70 119 99 71 86 104 99 109 70 117 89 50 85 103
         98 50 89 103 82 48 120 104 82 69 57 84 73 71 104 104 90 67 66 110
         98 50 53 108 73 72 82 111 99 109 57 49 90 50 103 103 99 50 86 50 90 88
         74 104 98 67 66 107 90 88 78 112 90 50 53 122 76 67 66 118 98 109 85
         103 100 50 104 112 89 50 103 103 90 109 86 104 100 72 86 121 90 87
         81 103 89 83 66 115 89 88 74 110 90 83 66 107 97 88 78 114 73 71 74
         108 98 71 57 51 73 71 104 108 99 105 52 103 84 87 78 77 89 87 108 117
         73 71 108 116 97 88 82 104 100 71 86 107 73 71 82 112 89 87 120 118 90
         121 66 51 99 109 108 48 100 71 86 117 73 71 108 117 73 71 69 103
         100 71 86 52 100 67 49 48 98 121 49 122 99 71 86 108 89 50 103 103 99
         72 74 118 90 51 74 104 98 83 66 51 97 88 82 111 73 71 104 108 99 105
         66 118 100 50 52 103 100 109 57 112 89 50 85 115 73 72 100 111 97 87
         78 111 73 72 100 104 99 121 66 115 89 88 82 108 99 105 66 106 98 50
         53 50 90 88 74 48 90 87 81 103 100 71 56 103 99 50 57 49 98 109 81 103
         98 87 57 121 90 83 66 121 98 50 74 118 100 71 108 106 76 105 66 84 97
         71 85 103 89 87 120 122 98 121 66 122 89 87 53 110 73 72 82 111 90
         83 66 115 101 88 74 112 89 51 77 103 90 109 57 121 73 67 74 84 100 71
         108 115 98 67 66 66 98 71 108 50 90 83 73 115 73 72 100 121 97 88 82
         48 90 87 52 103 89 110 107 103 83 109 57 117 89 88 82 111 89 87 52 103
         81 50 57 49 98 72 82 118 98 105 119 103 100 50 104 112 89 50 103
         103 99 71 120 104 101 87 86 107 73 71 82 49 99 109 108 117 90 121 66
         48 97 71 85 103 89 51 74 108 90 71 108 48 99 121 66 118 90 105 66 81
         98 51 74 48 89 87 119 117 73 70 82 111 90 83 66 122 98 50 53 110 73 71
         74 108 89 50 70 116 90 83 66 111 100 87 100 108 98 72 107 103 99 51
         86 106 89 50 86 122 99 50 90 49 98 68 115 103 97 88 81 103 89 88 66
         119 90 87 70 121 90 87 81 103 97 87 52 103 100 71 104 108 73 70 74 118
         89 50 115 103 81 109 70 117 90 67 66 122 90 88 74 112 90 88 77 103
         89 87 53 107 73 71 104 104 99 121 66 105 90 87 86 117 73 71 69 103 99
         71 57 119 100 87 120 104 99 105 66 122 98 50 53 110 73 71 90 118 99
         105 66 90 98 51 86 85 100 87 74 108 73 72 86 122 90 88 74 122 73 72 82
         118 73 71 78 118 100 109 86 121 76 103 61 61))

   (let ((in (list 10 89 87 74 106 90 71 10 86 109 90 119 61 61 10)))
     (equal? (list 89 87 74 106 90 71 86 109 90 119 61 61)
             (bytevector->u8-list
              (base64:scrub-encoded (u8-list->bytevector in)))))

   #t))
